name: Acceptance Test
on: [push, pull_request]

jobs:
  mysql80:
    runs-on: ubuntu-latest
    env:
      CONTAINER_USER: root
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1 # shallow clone
      - name: Build the stack
        run: docker-compose -f docker-compose.yml -f docker-compose/mysql80.yml build
      - name: run test
        run: docker-compose -f docker-compose.yml -f docker-compose/mysql80.yml run -e MYSQL_HOST=mysql80 app acceptance/run_test.sh
  mysql57:
    runs-on: ubuntu-latest
    env:
      CONTAINER_USER: root
    steps:
      - uses: actions/checkout@v1
        with:
          fetch-depth: 1 # shallow clone
      - name: Build the stack
        run: docker-compose -f docker-compose.yml -f docker-compose/mysql57.yml build
      - name: run test
        run: docker-compose -f docker-compose.yml -f docker-compose/mysql57.yml run -e MYSQL_HOST=mysql57 app acceptance/run_test.sh
